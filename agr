ðŸ”§ Step 1 â€” Add Safe Param Builder

Add this method to the class:

private Map<String, String> buildSafeParamMap(Map<String, String> filterConditions) {
    Map<String, String> safe = new LinkedHashMap<>();
    if (filterConditions == null || filterConditions.isEmpty()) {
        return safe;
    }
    int i = 0;
    for (String key : filterConditions.keySet()) {
        safe.put(key, "p" + i++);
    }
    return safe;
}


Add import:

import java.util.LinkedHashMap;

ðŸ”§ Step 2 â€” Fix getFindAllQueryFilters
Replace this:
private void getFindAllQueryFilters(StringBuilder sb, Map<String,String> filterConditions)

With this:
private void getFindAllQueryFilters(StringBuilder sb,
                                    Map<String,String> filterConditions,
                                    Map<String,String> safeParams) {

    if(filterConditions != null && !filterConditions.isEmpty()) {
        for (Map.Entry<String, String> entry : filterConditions.entrySet()) {
            for (SecurityUsersColumnEnum col : SecurityUsersColumnEnum.values()) {
                if (col.getColumnId().equals(entry.getKey())) {

                    String paramName = safeParams.get(entry.getKey());

                    sb.append(" and lower(")
                      .append(col.getColumnStringOrderFilterBy())
                      .append(") like :")
                      .append(paramName);
                }
            }
        }
    }
}

ðŸ”§ Step 3 â€” Fix setFindAllQueryFilters
Replace with:
private void setFindAllQueryFilters(Query query,
                                    Map<String,String> filterConditions,
                                    Map<String,String> safeParams) {

    if(filterConditions != null && !filterConditions.isEmpty()) {
        for (Map.Entry<String, String> entry : filterConditions.entrySet()) {
            for (SecurityUsersColumnEnum col : SecurityUsersColumnEnum.values()) {
                if (col.getColumnId().equals(entry.getKey())) {

                    String paramName = safeParams.get(entry.getKey());

                    query.setString(paramName,
                            getLowerSearchString(entry.getValue()));
                }
            }
        }
    }
}

ðŸ”§ Step 4 â€” Fix findAllUsers

Replace:

getFindAllQueryFilters(sb, filterConditions);


with:

Map<String, String> safeParams = buildSafeParamMap(filterConditions);
getFindAllQueryFilters(sb, filterConditions, safeParams);


Replace:

setFindAllQueryFilters(query, filterConditions);


with:

setFindAllQueryFilters(query, filterConditions, safeParams);

ðŸ”§ Step 5 â€” Fix findStateUsers

Replace:

getFindAllQueryFilters(sb, filterConditions);


with:

Map<String, String> safeParams = buildSafeParamMap(filterConditions);
getFindAllQueryFilters(sb, filterConditions, safeParams);


Replace:

setFindAllQueryFilters(query, filterConditions);


with:

setFindAllQueryFilters(query, filterConditions, safeParams)
