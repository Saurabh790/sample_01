import static org.junit.jupiter.api.Assertions.*;

import org.junit.jupiter.api.Test;
import org.modelmapper.ModelMapper;
import org.modelmapper.convention.MatchingStrategies;
import org.springframework.test.util.ReflectionTestUtils;

import com.azure.security.keyvault.secrets.SecretClient;

class CommonConfigTest {

    @Test
    void modelMapper_configuredWithStrictMatchingAndAmbiguityIgnored() {
        CommonConfig config = new CommonConfig();

        ModelMapper mapper = config.modelMapper();

        assertNotNull(mapper);
        assertEquals(MatchingStrategies.STRICT, mapper.getConfiguration().getMatchingStrategy());
        assertTrue(mapper.getConfiguration().isAmbiguityIgnored());
    }

    @Test
    void secretClient_createsBean_whenPropertiesPresent() {
        CommonConfig config = new CommonConfig();

        // set @Value fields manually (since we aren't running Spring context here)
        ReflectionTestUtils.setField(config, "azureKeyVaultUrl", "https://dummy.vault.azure.net/");
        ReflectionTestUtils.setField(config, "azureKeyVaultTenant", "dummy-tenant");
        ReflectionTestUtils.setField(config, "azureKeyVaultClientId", "dummy-client");
        ReflectionTestUtils.setField(config, "azureKeyVaultSecret", "dummy-secret");

        SecretClient client = config.secretClient();
        assertNotNull(client);
    }
}
