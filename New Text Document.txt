@PostMapping(value = { "/save-case-batch" })
	public ResponseEntity saveCaseBatch(@RequestBody @Valid CaseBatchDataDTO caseBatchDataDTO) {

		List<CaseBatchResultDTO> caseBatchResultDTOList;
		try {
			Authentication auth =  SecurityContextHolder.getContext().getAuthentication();
			if (auth != null) {
				AppUser user = (AppUser) auth.getPrincipal();
				caseBatchDataDTO.setUiSystemId(user.getUserSystemId());
			}
			if (caseBatchDataDTO.getBasicClaimDataList().isEmpty()) {
				return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(CaseEntryConstants.EMPTY_CLAIMS_LIST);
			} else {
				caseBatchResultDTOList = iCaseValuesService.addCaseBatch(caseBatchDataDTO);
                return ResponseEntity.status(HttpStatus.OK).body(caseBatchResultDTOList);
			}
		} catch (CaseEntryApiException ex) {
			return ResponseEntity.status(HttpStatus.BAD_REQUEST).body("Error occured while processing the save case batch request");
		}
		
	}
	
	
	public List<CaseBatchResultDTO> addCaseBatch(CaseBatchDataDTO caseBatchDataDTO){
		 List<CaUniverseBatchT> caUniverseBatchTList = new ArrayList<>();
		 LocalDateTime currentSqlDate = LocalDateTime.now(getZoneId());
		 SimpleDateFormat simpleDateFormatter = new SimpleDateFormat(CaseEntryConstants.DATE_FORMAT_MMDDYYYY_S, Locale.ENGLISH);

		 List <BasicClaimData> basicClaimDataList = caseBatchDataDTO.getBasicClaimDataList();
		 
		 double dateDouble;
		 boolean excelDate = checkForExcelDate(basicClaimDataList);
		 if (!excelDate) {
			 simpleDateFormatter = getDateFormat(caseBatchDataDTO);
		 }
		// For CaseStatusDate parse
		 SimpleDateFormat dateFormatter = new SimpleDateFormat(CaseEntryConstants.DATE_FORMAT_YYYYMMDD, Locale.ENGLISH);

		try {
			Integer caseBatchId = 0;
			Integer caseUniverseBatchId= 0;

			// Sort on provider ID as there will be a case for each provider ID
			if (basicClaimDataList.size() > 2) {
				basicClaimDataList.sort(Comparator.comparing(BasicClaimData::getProviderId));
			}
			// Batch ID based on CA_UNIVERSE_T as there may be no batches currently
			caseBatchId = caUniverseBatchRepository.getNextBatchId();
			if (caseBatchId == null) {
				caseBatchId = 1;
			}
			// Users can add multiple batches
			
			for (BasicClaimData basicClaimData : basicClaimDataList) {
				// Case batch ID does not change with change in Provider ID	
				CaUniverseBatchT caUniverseBatchT = new CaUniverseBatchT();
				
				if (caseBatchDataDTO.getUiSystemId() != null) {
					UiUserBase uiUserBase = new UiUserBase();
					uiUserBase.setUiSystemId(caseBatchDataDTO.getUiSystemId());
					caUniverseBatchT.setUiUserBase(uiUserBase);			// Set UiUserBase
				}
				
					caUniverseBatchT.setCtBatchId(caseBatchId);
				
				caUniverseBatchT.setCtBatchDate(currentSqlDate);
				caUniverseBatchT.setHdrClmTcn(basicClaimData.getHdrClaimTCN());
				caUniverseBatchT.setLiNum(basicClaimData.getLiNum());
				if (excelDate) {
				//	log.info("exceldate parse HdrClmTcn HdrClaimPdDt " + basicClaimData.getHdrClaimTCN() + " " + basicClaimData.getHdrClaimPdDt());
					dateDouble = Double.parseDouble(basicClaimData.getHdrClaimPdDt());
					caUniverseBatchT.setHdrClmPdDt(DateUtil.getJavaDate(dateDouble));
				} else {
				//	log.info("simpleDateFormatter HdrClmTcn HdrClaimPdDt " + basicClaimData.getHdrClaimTCN() +  " " + basicClaimData.getHdrClaimPdDt());
					caUniverseBatchT.setHdrClmPdDt(simpleDateFormatter.parse(basicClaimData.getHdrClaimPdDt()));	// Default pattern is yyyy-MM-dd
				}
				
				//caUniverseBatchT.setId(caUniverseBatchTPK);
				caUniverseBatchT.setLiDrugValidClmInd(basicClaimData.getLiDrugValidClmInd());
				
				caUniverseBatchT.setCaseTypeCd(caseBatchDataDTO.getCaseType());
				if(!caUniverseBatchT.getCaseTypeCd().equals(CaseEntryConstants.CASE_TYPE_MEMBER_CD)) {
					caUniverseBatchT.setProvRole(caseBatchDataDTO.getProviderRole());
				} else {
					caUniverseBatchT.setProvRole(null);
				}
				caUniverseBatchT.setCaPrmNodeCd(caseBatchDataDTO.getPrmNodeCd());
				caUniverseBatchT.setCaYearId(Integer.valueOf(caseBatchDataDTO.getCaseYear()));
				caUniverseBatchT.setProjectStatus(caseBatchDataDTO.getProtectStatus());
				if (caseBatchDataDTO.getInvstTypeCd().isEmpty()) {
					caUniverseBatchT.setInvstTypeCd(null);
				} else {
					caUniverseBatchT.setInvstTypeCd(caseBatchDataDTO.getInvstTypeCd());
				}
				if (caseBatchDataDTO.getCaseSourceCd().isEmpty()) {	// Not required
					caUniverseBatchT.setCaseSourceCd(null);
				} else {
					caUniverseBatchT.setCaseSourceCd(caseBatchDataDTO.getCaseSourceCd());
				}
				if (caseBatchDataDTO.getCaseStatus().isEmpty()) {
					caUniverseBatchT.setCaseStatusCd(null);
				} else {
					caUniverseBatchT.setCaseStatusCd(caseBatchDataDTO.getCaseStatus());
				}
				if (!(caseBatchDataDTO.getCaseStatusDate() == null || caseBatchDataDTO.getCaseStatusDate().equals(CaseEntryConstants.EMPTY_STR))) {
					caUniverseBatchT.setCaseStatusDt(dateFormatter.parse(caseBatchDataDTO.getCaseStatusDate()));
				} else {
					caUniverseBatchT.setCaseStatusDt(null);
				}
				if (caseBatchDataDTO.getCaseIssue().isEmpty()) {	// Not required 
					caUniverseBatchT.setIssueCd(null);
				} else {
					caUniverseBatchT.setIssueCd(caseBatchDataDTO.getCaseIssue());
				}
				if (caseBatchDataDTO.getAssignUser().isEmpty()) {
					caUniverseBatchT.setAssignUsr(null);
				} else {
					caUniverseBatchT.setAssignUsr(caseBatchDataDTO.getAssignUser());
				}
				if (caseBatchDataDTO.getAssignSection().isEmpty()) {	// Not required if investigation type not selected
					caUniverseBatchT.setAssignSectionCd(null);
				} else {
					caUniverseBatchT.setAssignSectionCd(caseBatchDataDTO.getAssignSection());
				}
				if (!(caseBatchDataDTO.getAssignDate() == null || caseBatchDataDTO.getAssignDate().equals(CaseEntryConstants.EMPTY_STR))) {
					caUniverseBatchT.setAssignDate(dateFormatter.parse(caseBatchDataDTO.getAssignDate()));
				} else {
					caUniverseBatchT.setAssignDate(null);
				}
				
				caUniverseBatchT.setParticipantId(basicClaimData.getProviderId());

				caUniverseBatchTList.add(caUniverseBatchT);

			//	log.info(" Added Case Batch data Case Type, Batch ID = " + caseBatchDataDTO.getCaseType() + " " + caseBatchId);
			}
			caUniverseBatchRepository.saveAll(caUniverseBatchTList);
			caUniverseBatchRepository.flush();

		} catch (Exception e) {
			log.info(" Exception = " + e.getMessage());
			throw new CaseEntryApiException(e);
		} 	
		
	    return new ArrayList<CaseBatchResultDTO>();
	}	
	
	
	
	/**
 * 
 */
package com.optum.fads.caseentry.api.repo;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.JpaSpecificationExecutor;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.optum.fads.caseentry.api.domain.CaUniverseBatchT;

/**
 * @author awagh
 *
 */

@Transactional
@Repository
public interface CaUniverseBatchRepository extends JpaRepository<CaUniverseBatchT, Integer>, JpaSpecificationExecutor<CaUniverseBatchT>{
	
	//@Query(value = "SELECT  Max(CT_BATCH_ID+1) FROM CA_UNIVERSE_BATCH_T", nativeQuery = true)
    @Query(value = " SELECT MAX(CT_BATCH_ID +1) AS CT_BATCH_ID FROM ( " +
            " SELECT MAX(CT_BATCH_ID) AS CT_BATCH_ID FROM CA_UNIVERSE_T " +
            " UNION " +
            " SELECT MAX(CT_BATCH_ID) AS CT_BATCH_ID FROM CA_UNIVERSE_BATCH_T " +
            ") AS CA_UNIVERSE_MAX_ID", nativeQuery = true)
	Integer getNextBatchId();
	
	@Modifying
	@Query("DELETE FROM CaUniverseBatchT cb  WHERE cb.ctBatchId = :batchId")
	int deleteCaseBatch(@Param("batchId") Integer batchId  );

}


seconds (process running for 15.736)
2026-02-22T18:28:07.121+05:30  INFO 26256 --- [nio-8080-exec-3] o.a.c.c.C.[.[localhost].[/caseentry]     : Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-02-22T18:28:07.128+05:30  INFO 26256 --- [nio-8080-exec-3] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2026-02-22T18:28:07.131+05:30  INFO 26256 --- [nio-8080-exec-3] o.s.web.servlet.DispatcherServlet        : Completed initialization in 2 ms
2026-02-22T18:28:08.383+05:30  WARN 26256 --- [nio-8080-exec-3] o.h.engine.jdbc.spi.SqlExceptionHelper   : SQL Error: 515, SQLState: 23000
2026-02-22T18:28:08.388+05:30 ERROR 26256 --- [nio-8080-exec-3] o.h.engine.jdbc.spi.SqlExceptionHelper   : Cannot insert the value NULL into column 'CA_BATCH_ROWSEQ', table 'pi-dev-db.dbo.CA_UNIVERSE_BATCH_T'; column does not allow nulls. INSERT fails.
2026-02-22T18:28:08.397+05:30  INFO 26256 --- [nio-8080-exec-3] c.o.f.c.a.s.impl.CaseValuesService       :  Exception = could not execute statement [Cannot insert the value NULL into column 'CA_BATCH_ROWSEQ', table 'pi-dev-db.dbo.CA_UNIVERSE_BATCH_T'; column does not allow nulls. INSERT fails.] [insert into CA_UNIVERSE_BATCH_T (ASSIGN_DATE,ASSIGN_SECTION_CD,ASSIGN_USR,CA_PRM_NODE_CD,CA_YEAR_ID,CASE_SOURCE_CD,CASE_STATUS_CD,CASE_STATUS_DT,CASE_TYPE_CD,CT_BATCH_DATE,CT_BATCH_ID,HDR_CLM_PD_DT,HDR_CLM_TCN,INVST_TYPE_CD,ISSUE_CD,LI_DRUG_VALID_CLM_IND,LI_NUM,PARTICIPANT_ID,PROTECT_STATUS,PROV_ROLE,REC_MATCH_IND,UI_SYSTEM_ID) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)]; SQL [insert into CA_UNIVERSE_BATCH_T (ASSIGN_DATE,ASSIGN_SECTION_CD,ASSIGN_USR,CA_PRM_NODE_CD,CA_YEAR_ID,CASE_SOURCE_CD,CASE_STATUS_CD,CASE_STATUS_DT,CASE_TYPE_CD,CT_BATCH_DATE,CT_BATCH_ID,HDR_CLM_PD_DT,HDR_CLM_TCN,INVST_TYPE_CD,ISSUE_CD,LI_DRUG_VALID_CLM_IND,LI_NUM,PARTICIPANT_ID,PROTECT_STATUS,PROV_ROLE,REC_MATCH_IND,UI_SYSTEM_ID) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)]; constraint [null]



{
    "assignDate": "2026-02-10",
    "assignSection": "8",
    "assignUser": "AK45678946",
    "caseIssue": "24",
    "caseSourceCd": "40",
    "caseStatus": "14",
    "caseStatusDate": "2026-02-01",
    "caseType": "PV",
    "caseYear": "2026",
    "invstTypeCd": "FSI",
    "prmNodeCd": "PAU",
    "protectStatus": "N",
    "providerRole": "BP",
    "uiSystemId": "",
    "basicClaimDataList": [
        {
            "providerId": "206887407",
            "hdrClaimPdDt": "8/6/2020",
            "hdrClaimTCN": "2520207004713",
            "liNum": "1",
            "liDrugValidClmInd": "N"
        },
        {
            "providerId": "206887407",
            "hdrClaimPdDt": "8/6/2020",
            "hdrClaimTCN": "2520207005248",
            "liNum": "1",
            "liDrugValidClmInd": "N"
        },
        {
            "providerId": "206887407",
            "hdrClaimPdDt": "8/6/2020",
            "hdrClaimTCN": "2520207005560",
            "liNum": "1",
            "liDrugValidClmInd": "N"
        },
        {
            "providerId": "206887407",
            "hdrClaimPdDt": "8/6/2020",
            "hdrClaimTCN": "2520207005567",
            "liNum": "1",
            "liDrugValidClmInd": "N"
        },
        {
            "providerId": "206887407",
            "hdrClaimPdDt": "8/6/2020",
            "hdrClaimTCN": "2520207008736",
            "liNum": "1",
            "liDrugValidClmInd": "N"
        },
        {
            "providerId": "206887407",
            "hdrClaimPdDt": "8/6/2020",
            "hdrClaimTCN": "2520207008805",
            "liNum": "1",
            "liDrugValidClmInd": "N"
        }
    ]
}

given the code getting issue with above payload 
