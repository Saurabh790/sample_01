
/**
 * @author awagh
 *
 */
package com.optum.fads.pgp.reportsection.api.mapper;

import org.mapstruct.Mapper;
import org.mapstruct.Mapping;
import org.mapstruct.Mappings;
import org.mapstruct.ReportingPolicy;
import org.mapstruct.factory.Mappers;

import com.optum.fads.pgp.reportsection.api.domain.PrmRiRptItemT;
import com.optum.fads.pgp.reportsection.api.domain.PrmRsRptSecT;
import com.optum.fads.pgp.reportsection.api.dto.ReportItemDTO;
import com.optum.fads.pgp.reportsection.api.dto.ReportSectionDTO;


@Mapper(componentModel = "spring", unmappedTargetPolicy = ReportingPolicy.IGNORE)
public interface ReportGroupDetailMapper {
	ReportGroupDetailMapper INSTANCE = Mappers.getMapper(ReportGroupDetailMapper.class);

	@Mappings({ @Mapping(source = "reportItemId", target = "riId"), 
			@Mapping(source = "reportItemName", target = "reportItemName"),
			@Mapping(source = "calcFMT", target = "riCalcFmt"),
			@Mapping(source = "minimumDenominator", target = "riMinimumDenom"),
			@Mapping(source = "divideConstant", target = "constantDen"),
			@Mapping(source = "multipleConstant", target = "constantNum"),
			@Mapping(source = "createdBySystemId", target = "uiUserBaseCr.uiSystemId"),
			@Mapping(source = "modifiedBySystemId", target = "uiUserBaseUpd.uiSystemId") })
	PrmRiRptItemT convertToPrmRiRptItemT(ReportItemDTO reportItemDTO);
	
	@Mappings({ @Mapping(source = "reportSectionId", target = "rsId"), 
			@Mapping(source = "reportSectionName", target = "reportSectionName"),
			@Mapping(source = "createdBySystemId", target = "uiUserBaseCr.uiSystemId"),
			@Mapping(source = "modifiedBySystemId", target = "uiUserBaseUpd.uiSystemId") })
	PrmRsRptSecT convertToPrmRsRptSecT(ReportSectionDTO reportSectionDTO);

}

package com.optum.fads.pgp.reportsection.api.repo;

import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.optum.fads.pgp.reportsection.api.domain.PrmErDrT;
import com.optum.fads.pgp.reportsection.api.domain.PrmErdrTPK;


@Transactional
@Repository
public interface BehaviorPatternErDrRepository extends  JpaRepository <PrmErDrT, PrmErdrTPK>{
	
	@Query(" FROM PrmErDrT pe  where pe.id.erId = :erId ORDER BY pe.id.drId")
	List<PrmErDrT> retrieveErDrValues(@Param("erId") Integer erId );
	
	@Modifying
	@Query("DELETE FROM PrmErDrT ed  WHERE ed.id.erId IN :extractRuleIds") 
	int deleteErDrs(@Param("extractRuleIds") List<Integer>  extractRuleIds  );
	
	@Modifying
	@Query("DELETE FROM PrmErDrT ed  WHERE ed.id.erId = :extractRuleId") 
	int deleteErDrById(@Param("extractRuleId") Integer  extractRuleId  );

}
package com.optum.fads.pgp.reportsection.api.repo;

import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.optum.fads.pgp.reportsection.api.domain.PrmBpBehaviorPatsT;

@Transactional
@Repository
public interface BehaviorPatternsRepository extends  JpaRepository <PrmBpBehaviorPatsT, Integer>{
	
	@Query(" FROM PrmBpBehaviorPatsT b  where b.bpId = :behaviorPatternId ")
	PrmBpBehaviorPatsT getBehaviorPatternById(@Param("behaviorPatternId") Integer behaviorPatternId );
	
	@Query(" FROM PrmBpBehaviorPatsT bp WHERE bp.bpId not in "
			+ "(Select br.id.bpId FROM PrmBpRiFormulaT br  WHERE br.id.riId = :reportItemId) order by bp.bpId")
	List<PrmBpBehaviorPatsT> getAvailableBehaviorPatterns(@Param("reportItemId") Integer reportItemId);
	
	@Query(" FROM PrmBpBehaviorPatsT bp WHERE bp.bpId IN :bpIds") 
	List<PrmBpBehaviorPatsT> getBehaviorPatternsByIds(@Param("bpIds") List<Integer> bpIds);
	/*
	@Query("SELECT DISTINCT bp.prmErExtractRuleT.erId, bp.baId, bp.behaviorPatternName, bp.prmMbMasterT.mbCtecFid, bp.bpMaxCtecFieldId, bp.createDate, "  
			+ " bp.uiUserBaseCr.uiFirstName, bp.uiUserBaseCr.uiLastName, bp.updateDate, bp.uiUserBaseUpd.uiFirstName, bp.uiUserBaseUpd.uiLastName,"
			+ " f.luView, p1.mbCustDatadesc, p2.mbCustDatadesc "	// sum of, Data Element Name, Date Element Name
			+ " FROM PrmBpBehaviorPatsT bp, FadsLuValuesT f, PrmMbMasterT p1, PrmMbMasterT p2 "
			+ " RIGHT JOIN PrmBpBehaviorPatsT pbp ON pbp.bpMaxCtecFieldId = p2.mbCtecFid "
			+ "WHERE bp.bpId= :behaviorPatternId AND f.id.fieldId = 'BA_ID' and f.id.luValue=bp.baId "
			+ " AND p1.mbCtecFid = bp.prmMbMasterT.mbCtecFid AND p2.mbCustDatadesc IS NOT NULL" )*/
    @Query("SELECT DISTINCT bp.prmErExtractRuleT.erId, bp.baId, bp.behaviorPatternName, bp.prmMbMasterT.mbCtecFid, bp.bpMaxCtecFieldId, bp.createDate, "
            + " bp.uiUserBaseCr.uiFirstName, bp.uiUserBaseCr.uiLastName, bp.updateDate, bp.uiUserBaseUpd.uiFirstName, bp.uiUserBaseUpd.uiLastName,"
            + " f.luView, p1.mbCustDatadesc "	// sum of, Data Element Name, Date Element Name
            + " FROM PrmBpBehaviorPatsT bp ,  ( select id.luValue as luValue,luView as luView from FadsLuValuesT where id.fieldId = 'BA_ID' ) as f ,"
            + "  PrmMbMasterT p1  "
            + " WHERE bp.bpId= :behaviorPatternId and f.luValue=bp.baId  and p1.mbCtecFid = bp.prmMbMasterT.mbCtecFid " )
    List<Object[]> retrieveBehaviorPatternById(@Param("behaviorPatternId") Integer behaviorPatternId);

}
package com.optum.fads.pgp.reportsection.api.repo;

import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.optum.fads.pgp.reportsection.api.domain.PrmDrDataRuleT;

@Transactional
@Repository
public interface DataRulesRepository extends  JpaRepository <PrmDrDataRuleT, Integer> {
		
	@Query(" FROM PrmDrDataRuleT dr WHERE dr.drId not in "
			+ "(Select erdr.id.drId FROM PrmErDrT erdr  WHERE erdr.id.erId = :extractRuleId) order by dr.drId")
	List<PrmDrDataRuleT> getAvailableDataRules(@Param("extractRuleId") Integer extractRuleId);
	
	@Query(" FROM PrmDrDataRuleT pd, PrmErDrT pe WHERE pe.id.erId = :extractRuleId AND pe.id.drId = pd.drId ORDER BY pd.drId")
	List<PrmDrDataRuleT>  getDataRulesByErId(@Param("extractRuleId") Integer extractRuleId);
	
	@Query(" FROM PrmDrDataRuleT pd  where pd.drId in :dataruleIds ORDER BY pd.drId")
	List<PrmDrDataRuleT> getDataRulesByIds(@Param("dataruleIds") List<Integer> dataruleIds );
	
}
package com.optum.fads.pgp.reportsection.api.repo;

import java.util.List;
import java.util.Optional;

import jakarta.persistence.LockModeType;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Lock;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.optum.fads.pgp.reportsection.api.domain.PrmBpRiFormulaT;
import com.optum.fads.pgp.reportsection.api.domain.PrmBpRiFormulaTPK;

@Transactional
@Repository
public interface ReportItemFormulasRepository extends  JpaRepository <PrmBpRiFormulaT, PrmBpRiFormulaTPK>{
		
	@Lock(value = LockModeType.OPTIMISTIC)
	  Optional<PrmBpRiFormulaT> findById(PrmBpRiFormulaTPK id);
	
	@Query(" FROM PrmBpRiFormulaT rf  where rf.id.riId = :reportItemId ")
	List<PrmBpRiFormulaT> retrieveRiFormulas(@Param("reportItemId") Integer reportItemId );
	
	@Modifying
	@Query("DELETE FROM PrmBpRiFormulaT rf WHERE rf.id.riId IN :reportItemIds") 
	int deleteReportItemFormulas(@Param("reportItemIds") List<Integer> reportItemIds  );
	
	@Modifying
	@Query("DELETE FROM PrmBpRiFormulaT rf WHERE rf.id.riId = :reportItemId") 
	int deleteReportItemFormulaByRiId(@Param("reportItemId") Integer reportItemId  );
		
}
package com.optum.fads.pgp.reportsection.api.repo;

import java.util.List;

import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.JpaSpecificationExecutor;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.optum.fads.pgp.reportsection.api.domain.PrmRiRptItemT;

@Transactional
@Repository
public interface ReportItemsRepository extends  JpaRepository <PrmRiRptItemT, Integer>, JpaSpecificationExecutor<PrmRiRptItemT>{
		
	@Query(" FROM PrmRiRptItemT ri  where ri.riId = :reportItemId ")
	PrmRiRptItemT getReportItemById(@Param("reportItemId") Integer reportItemId );
	
	@Query(" FROM PrmRiRptItemT ri  where lower(ri.reportItemName) = :reportItemName ")
	PrmRiRptItemT getReportItemByName(@Param("reportItemName") String reportItemName );
	
	@Query("SELECT MAX(riId)+1 FROM PrmRiRptItemT")
	Integer retrieveNextRiId();
	
	@Query(" FROM PrmRiRptItemT ri" )
	List<PrmRiRptItemT> getReportItems(Pageable pageRequest );
	
	@Query(" FROM PrmRiRptItemT ri WHERE ri.riId NOT IN :riIds" )
	List<PrmRiRptItemT> getAvailableReportItems(@Param("riIds") List<Integer> riIds, Pageable pageRequest );
	
	@Query(" FROM PrmRiRptItemT ri  where lower(ri.reportItemName) like :reportItemName "
			+ "and (lower(ri.uiUserBaseCr.userFullName) like :createdBy or lower(ri.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(ri.uiUserBaseUpd.userFullName) like :updatedBy or lower(ri.uiUserBaseUpd.uiLastName) like :updatedBy)" )
	List<PrmRiRptItemT> getReportItemsBySearchCrit(@Param("reportItemName") String reportItemName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy, Pageable pageRequest );
	
	// My items
	
	@Query(" FROM PrmRiRptItemT ri  where lower(ri.reportItemName) like :reportItemName " 
			+ "and (lower(ri.uiUserBaseCr.userFullName) like :createdBy or lower(ri.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(ri.uiUserBaseUpd.userFullName) like :updatedBy or lower(ri.uiUserBaseUpd.uiLastName) like :updatedBy)" 
			+ "and (lower(ri.uiUserBaseCr.uiSystemId) = :userSystemId or lower(ri.uiUserBaseUpd.uiSystemId) = :userSystemId)")
	List<PrmRiRptItemT> getMyReportItemsBySearchCrit(@Param("reportItemName") String reportItemName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy,  @Param("userSystemId") String userSystemId, 
			Pageable pageRequest );
	
	// Query for special characters in the report item name
	
	@Query(" FROM PrmRiRptItemT ri  where lower(ri.reportItemName) like :reportItemName ESCAPE '\\' "
			+ "and (lower(ri.uiUserBaseCr.userFullName) like :createdBy or lower(ri.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(ri.uiUserBaseUpd.userFullName) like :updatedBy or lower(ri.uiUserBaseUpd.uiLastName) like :updatedBy)" )
	List<PrmRiRptItemT> getReportItemsBySearchCritEsc(@Param("reportItemName") String reportItemName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy, Pageable pageRequest );
	
	// My Items Query for special characters in the report item name
	
	@Query(" FROM PrmRiRptItemT ri  where lower(ri.reportItemName) like :reportItemName ESCAPE '\\' "
			+ "and (lower(ri.uiUserBaseCr.userFullName) like :createdBy or lower(ri.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(ri.uiUserBaseUpd.userFullName) like :updatedBy or lower(ri.uiUserBaseUpd.uiLastName) like :updatedBy)" 
			+ "and (lower(ri.uiUserBaseCr.uiSystemId) = :userSystemId or lower(ri.uiUserBaseUpd.uiSystemId) = :userSystemId)")
	List<PrmRiRptItemT> getMyReportItemsBySearchCritEsc(@Param("reportItemName") String reportItemName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy,  @Param("userSystemId") String userSystemId, 
			Pageable pageRequest );
	
	// Selected Items
	
	@Query(" FROM PrmRiRptItemT ri  where lower(ri.reportItemName) like :reportItemName "
			+ "and (lower(ri.uiUserBaseCr.userFullName) like :createdBy or lower(ri.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(ri.uiUserBaseUpd.userFullName) like :updatedBy or lower(ri.uiUserBaseUpd.uiLastName) like :updatedBy)" 
			+ " and ri.riId NOT IN :riIds")
	List<PrmRiRptItemT> getAvailableReportItemsBySearchCrit(@Param("reportItemName") String reportItemName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy, @Param("riIds") List<Integer> riIds, 
			Pageable pageRequest );
	
	// My Items with Selected Items
	
	@Query(" FROM PrmRiRptItemT ri  where lower(ri.reportItemName) like :reportItemName "
			+ "and (lower(ri.uiUserBaseCr.userFullName) like :createdBy or lower(ri.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(ri.uiUserBaseUpd.userFullName) like :updatedBy or lower(ri.uiUserBaseUpd.uiLastName) like :updatedBy)" 
			+ "and (lower(ri.uiUserBaseCr.uiSystemId) = :userSystemId or lower(ri.uiUserBaseUpd.uiSystemId) = :userSystemId)"
			+ " and ri.riId NOT IN :riIds")
	List<PrmRiRptItemT> getMyAvailableReportItemsBySearchCrit(@Param("reportItemName") String reportItemName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy, @Param("userSystemId") String userSystemId,
			@Param("riIds") List<Integer> riIds, Pageable pageRequest );
	
	// Query for special characters in the report item name, with Selected Items
	
	@Query(" FROM PrmRiRptItemT ri  where lower(ri.reportItemName) like :reportItemName ESCAPE '\\' "
			+ "and (lower(ri.uiUserBaseCr.userFullName) like :createdBy or lower(ri.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(ri.uiUserBaseUpd.userFullName) like :updatedBy or lower(ri.uiUserBaseUpd.uiLastName) like :updatedBy)"  
			+ " and ri.riId NOT IN :riIds")
	List<PrmRiRptItemT> getAvailableReportItemsBySearchCritEsc(@Param("reportItemName") String reportItemName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy, @Param("riIds") List<Integer> riIds, 
			Pageable pageRequest );
	
	// My Items Query for special characters in the report item name, with Selected Items
	
	@Query(" FROM PrmRiRptItemT ri  where lower(ri.reportItemName) like :reportItemName ESCAPE '\\' "
			+ "and (lower(ri.uiUserBaseCr.userFullName) like :createdBy or lower(ri.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(ri.uiUserBaseUpd.userFullName) like :updatedBy or lower(ri.uiUserBaseUpd.uiLastName) like :updatedBy)" 
			+ "and (lower(ri.uiUserBaseCr.uiSystemId) = :userSystemId or lower(ri.uiUserBaseUpd.uiSystemId) = :userSystemId)"   
			+ " and ri.riId NOT IN :riIds")
	List<PrmRiRptItemT> getMyAvailableReportItemsBySearchCritEsc(@Param("reportItemName") String reportItemName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy, @Param("userSystemId") String userSystemId,
			@Param("riIds") List<Integer> riIds, Pageable pageRequest );
	
	
	@Modifying
	@Query("DELETE FROM PrmRiRptItemT ri WHERE ri.riId = :reportItemId") 
	int deleteReportItem(@Param("reportItemId") Integer  reportItemId  );
	
	@Query(" FROM PrmRiRptItemT ri WHERE ri.riId IN :riIds") 
	List<PrmRiRptItemT> getReportItemsByIds(@Param("riIds") List<Integer> riIds);
	
	@Query(" FROM  PrmRiRptItemT ri WHERE lower(ri.reportItemName) like :reportItemName "
				+ "AND ri.uiUserBaseCr.uiUserId = :loginId")
	List< PrmRiRptItemT> getItems(@Param("reportItemName") String reportItemName, 
				@Param("loginId") String loginId, Pageable pageRequest );
		
	@Query(" FROM  PrmRiRptItemT ri WHERE lower(ri.reportItemName) like :reportItemName ESCAPE '\\' "
				+ "AND ri.uiUserBaseCr.uiUserId = :loginId")
	List<PrmRiRptItemT> getItemsEsc(@Param("reportItemName") String reportItemName, 
				@Param("loginId") String loginId, Pageable pageRequest );
	
	@Query(" FROM PrmRiRptItemT ri  WHERE ri.riId not in "
			+ "(Select rsri.id.riId FROM PrmRsRiT rsri  WHERE rsri.id.rsId = :reportSectionId) order by ri.riId")
	List<PrmRiRptItemT> getAvailableReportItems(@Param("reportSectionId") Integer reportSectionId);
	
}
package com.optum.fads.pgp.reportsection.api.repo;

import java.util.List;
import java.util.Optional;

import jakarta.persistence.LockModeType;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Lock;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.optum.fads.pgp.reportsection.api.domain.PrmRsRiT;
import com.optum.fads.pgp.reportsection.api.domain.PrmRsRiTPK;
import com.optum.fads.pgp.reportsection.api.domain.PrmStudyRsRiT;

@Transactional
@Repository
public interface ReportSectionItemsRepository extends  JpaRepository <PrmRsRiT, PrmRsRiTPK>{	
	
	@Lock(value = LockModeType.PESSIMISTIC_WRITE)
	  Optional<PrmRsRiT> findById(PrmRsRiTPK id);
	
	@Query(" FROM PrmRsRiT rsri  where rsri.id.rsId = :reportSectionId ORDER BY rsri.riOrder")
	List<PrmRsRiT> getReportSectionItemsByRsId(@Param("reportSectionId") Integer reportSectionId );
	
	@Modifying
	@Query("DELETE FROM PrmRsRiT rsri  WHERE rsri.id.rsId = :reportSectionId") 
	int deleteReportSectionItemsByRsId(@Param("reportSectionId") Integer  reportSectionId  );
	
	@Modifying
	@Query("DELETE FROM PrmRsRiT rsri  WHERE rsri.id.riId = :reportItemId") 
	int deleteReportSectionItemByRiId(@Param("reportItemId") Integer  reportItemId  );
	
	@Modifying
	@Query("DELETE FROM PrmRsRiT rsri  WHERE rsri.id.riId in :reportItemIds") 
	int deleteReportSectionItemByRiIds(@Param("reportItemIds") List<Integer> reportItemId  );
	
	@Query(" FROM PrmRsRiT rsri  WHERE rsri.id.rsId = :reportSectionId")
	List<PrmRsRiT> getRsRisByRsId(@Param("reportSectionId") Integer  reportSectionId );
	
	@Query(" FROM PrmRsRiT rsri  WHERE rsri.id.riId = :reportItemId")
	List<PrmRsRiT> getRsRisByRiId(@Param("reportItemId") Integer  reportItemId );
	
	@Modifying
	@Query("update PrmRsRiT rsri set rsri.riOrder = :riOrder where rsri.id.riId = :reportItemId") 
	int updateReportItemOrder(@Param("riOrder") Integer riOrder, @Param("reportItemId") Integer reportItemId);
	
	@Query(" FROM PrmStudyRsRiT strsri  WHERE strsri.id.rsId = :reportSectionId")
	List<PrmStudyRsRiT> getStudyRsRisByRsId(@Param("reportSectionId") Integer  reportSectionId );
		
}
package com.optum.fads.pgp.reportsection.api.repo;

import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.JpaSpecificationExecutor;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.data.domain.Pageable;

import com.optum.fads.pgp.reportsection.api.domain.PrmRiRptItemT;
import com.optum.fads.pgp.reportsection.api.domain.PrmRsRptSecT;

@Transactional
@Repository
public interface ReportSectionsRepository extends  JpaRepository <PrmRsRptSecT, Integer>, JpaSpecificationExecutor<PrmRsRptSecT>{
		
	@Query(" FROM PrmRsRptSecT rs  where rs.rsId = :reportSectionId ")
	PrmRsRptSecT getReportSectionById(@Param("reportSectionId") Integer reportSectionId );
	
	@Query(" FROM PrmRsRptSecT rs  where rs.rsId in :reportSectionIds ")
	List<PrmRsRptSecT> getReportSectionByIds(@Param("reportSectionIds") List<Integer> reportSectionIds );
	
	@Query(" FROM PrmRsRptSecT rs  where lower(rs.reportSectionName) = :reportSectionName ")
	PrmRsRptSecT getReportSectionByName(@Param("reportSectionName") String reportSectionName );
	
	@Query("SELECT MAX(rsId)+1 FROM PrmRsRptSecT")
	Integer retrieveNextRsId();
	
	@Query(" FROM PrmRsRptSecT rs" )
	List<PrmRsRptSecT> getReportSections(Pageable pageRequest );
	
	@Query(" FROM PrmRsRptSecT rs WHERE rs.rsId NOT IN :reportSectionIds" )
	List<PrmRsRptSecT> getAvailableReportSections(@Param("reportSectionIds") List<Integer> reportSectionIds, Pageable pageRequest );
	
	@Query(" FROM PrmRsRptSecT rs  where lower(rs.reportSectionName) like :reportSectionName "
			+ "and (lower(rs.uiUserBaseCr.userFullName) like :createdBy or lower(rs.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(rs.uiUserBaseUpd.userFullName) like :updatedBy or lower(rs.uiUserBaseUpd.uiLastName) like :updatedBy)" )
	List<PrmRsRptSecT> getReportSectionsBySearchCrit(@Param("reportSectionName") String reportSectionName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy, Pageable pageRequest );
	
	// My items
	
	@Query(" FROM PrmRsRptSecT rs  where lower(rs.reportSectionName) like :reportSectionName "
			+ "and (lower(rs.uiUserBaseCr.userFullName) like :createdBy or lower(rs.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(rs.uiUserBaseUpd.userFullName) like :updatedBy or lower(rs.uiUserBaseUpd.uiLastName) like :updatedBy)" 
			+ "and (lower(rs.uiUserBaseCr.uiSystemId) = :userSystemId or lower(rs.uiUserBaseUpd.uiSystemId) = :userSystemId)")
	List<PrmRsRptSecT> getMyReportSectionsBySearchCrit(@Param("reportSectionName") String reportSectionName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy,  @Param("userSystemId") String userSystemId,
			Pageable pageRequest );
	
	// Query for special characters in the report section name
	
	@Query(" FROM PrmRsRptSecT rs  where lower(rs.reportSectionName) like :reportSectionName  ESCAPE '\\' "
			+ "and (lower(rs.uiUserBaseCr.userFullName) like :createdBy or lower(rs.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(rs.uiUserBaseUpd.userFullName) like :updatedBy or lower(rs.uiUserBaseUpd.uiLastName) like :updatedBy)" )
	List<PrmRsRptSecT> getReportSectionsBySearchCritEsc(@Param("reportSectionName") String reportSectionName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy, Pageable pageRequest );
	
	// My Items Query for special characters in the report section name
	
	@Query(" FROM PrmRsRptSecT rs  where lower(rs.reportSectionName) like :reportSectionName  ESCAPE '\\' "
			+ "and (lower(rs.uiUserBaseCr.userFullName) like :createdBy or lower(rs.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(rs.uiUserBaseUpd.userFullName) like :updatedBy or lower(rs.uiUserBaseUpd.uiLastName) like :updatedBy)" 
			+ "and (lower(rs.uiUserBaseCr.uiSystemId) = :userSystemId or lower(rs.uiUserBaseUpd.uiSystemId) = :userSystemId)")
	List<PrmRsRptSecT> getMyReportSectionsBySearchCritEsc(@Param("reportSectionName") String reportSectionName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy, @Param("userSystemId") String userSystemId,
			Pageable pageRequest );
	
	// has Selected Items
	
	@Query(" FROM PrmRsRptSecT rs  where lower(rs.reportSectionName) like :reportSectionName "
			+ "and (lower(rs.uiUserBaseCr.userFullName) like :createdBy or lower(rs.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(rs.uiUserBaseUpd.userFullName) like :updatedBy or lower(rs.uiUserBaseUpd.uiLastName) like :updatedBy)" 
			+ " and rs.rsId NOT IN :rsIds")
	List<PrmRsRptSecT> getAvailableReportSectionsBySearchCrit(@Param("reportSectionName") String reportSectionName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy, @Param("rsIds") List<Integer> rsIds,
			Pageable pageRequest );
	
	// My Items with Selected Items
	
	@Query(" FROM PrmRsRptSecT rs  where lower(rs.reportSectionName) like :reportSectionName "
			+ "and (lower(rs.uiUserBaseCr.userFullName) like :createdBy or lower(rs.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(rs.uiUserBaseUpd.userFullName) like :updatedBy or lower(rs.uiUserBaseUpd.uiLastName) like :updatedBy)" 
			+ "and (lower(rs.uiUserBaseCr.uiSystemId) = :userSystemId or lower(rs.uiUserBaseUpd.uiSystemId) = :userSystemId)"
			+ " and rs.rsId NOT IN :rsIds")
	List<PrmRsRptSecT> getMyAvailableReportSectionsBySearchCrit(@Param("reportSectionName") String reportSectionName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy,  @Param("userSystemId") String userSystemId,
			@Param("rsIds") List<Integer> rsIds, Pageable pageRequest );
	
	// Query for special characters in the report section name, with Selected Items
	
	@Query(" FROM PrmRsRptSecT rs  where lower(rs.reportSectionName) like :reportSectionName  ESCAPE '\\' "
			+ "and (lower(rs.uiUserBaseCr.userFullName) like :createdBy or lower(rs.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(rs.uiUserBaseUpd.userFullName) like :updatedBy or lower(rs.uiUserBaseUpd.uiLastName) like :updatedBy)" 
			+ " and rs.rsId NOT IN :rsIds")
	List<PrmRsRptSecT> getAvailableReportSectionsBySearchCritEsc(@Param("reportSectionName") String reportSectionName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy, @Param("rsIds") List<Integer> rsIds,
			Pageable pageRequest );
	
	// My Items Query for special characters in the report section name, with Selected Items
	
	@Query(" FROM PrmRsRptSecT rs  where lower(rs.reportSectionName) like :reportSectionName  ESCAPE '\\' "
			+ "and (lower(rs.uiUserBaseCr.userFullName) like :createdBy or lower(rs.uiUserBaseCr.uiLastName) like :createdBy) "
			+ "and (lower(rs.uiUserBaseUpd.userFullName) like :updatedBy or lower(rs.uiUserBaseUpd.uiLastName) like :updatedBy)" 
			+ "and (lower(rs.uiUserBaseCr.uiSystemId) = :userSystemId or lower(rs.uiUserBaseUpd.uiSystemId) = :userSystemId)"
			+ " and rs.rsId NOT IN :rsIds")
	List<PrmRsRptSecT> getMyAvailableReportSectionsBySearchCritEsc(@Param("reportSectionName") String reportSectionName, 
			@Param("createdBy") String createdBy, @Param("updatedBy") String updatedBy,  @Param("userSystemId") String userSystemId,
			@Param("rsIds") List<Integer> rsIds, Pageable pageRequest );
	
	@Modifying
	@Query("DELETE FROM PrmRsRptSecT rs  WHERE rs.rsId = :reportSectionId") 
	int deleteReportSection(@Param("reportSectionId") Integer reportSectionId  );
	
	@Query(" FROM PrmRsRptSecT rs WHERE rs.rsId IN :rsIds") 
	List<PrmRsRptSecT> getReportSectionsByIds(@Param("rsIds") List<Integer> rsIds);
		
}
package com.optum.fads.pgp.reportsection.api.repo;

import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.optum.fads.pgp.reportsection.api.domain.PrmRsRptSecT;
import com.optum.fads.pgp.reportsection.api.domain.PrmStudyMasterT;


@Transactional
@Repository
public interface StudyRepository extends  JpaRepository <PrmRsRptSecT, Integer>{
	
	@Query(" FROM PrmStudyMasterT s  where s.pbId = :pbId ")
	PrmStudyMasterT getStudyByPbId(@Param("pbId") Integer pbId );
	
	@Query(" FROM PrmStudyMasterT s  where s.pbId in :pbIds ")
	List<PrmStudyMasterT> getStudyByPbIds(@Param("pbIds") List<Integer> pbIds );
	
}

package com.optum.fads.pgp.reportsection.api.repo;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import com.optum.fads.pgp.reportsection.api.domain.UiUserBase;

import java.util.Optional;

import jakarta.transaction.Transactional;
@Transactional
@Repository
public interface UserRepository extends JpaRepository<UiUserBase, String> {
	Optional<UiUserBase> findByUiEMailAddressOrUiUserId(String userEmail, String userId);

}
