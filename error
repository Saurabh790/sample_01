@Override
protected void configure(final HttpSecurity http) throws Exception {
    if (SECURITY_AUTH_TYPE_OPENTOKEN.equalsIgnoreCase(authType)) {

        http.csrf().requireCsrfProtectionMatcher(new CsrfSecurityRequestMatcher());
        http.headers().frameOptions().disable();
        http.addFilterBefore(ssoTokenFilter(), BasicAuthenticationFilter.class);

        // REMOVE this line (it can override your permitAll)
        // http.authorizeRequests().anyRequest().authenticated();

        http.authorizeRequests()
            .antMatchers("/login/**", "/signup", "/sessionexpired", "/logout", "/logout/**", "/signout/**",
                    "/signout", "/sessionout", "/styles/**", "/images/**", "/bower_components/**",
                    "/uitk-core/**", "/app/**", "/css/**", "/uitk/**", "/fonts/**")
            .permitAll()
            .anyRequest().authenticated();

        http.logout().logoutRequestMatcher(new AntPathRequestMatcher("/signout"))
            .logoutSuccessUrl("/signout")
            .deleteCookies("JSESSIONID")
            .invalidateHttpSession(true);

        http.exceptionHandling()
            .authenticationEntryPoint(authEntryPoint)
            .accessDeniedHandler(accessDeniedHandler);

    } else {

        http.csrf().requireCsrfProtectionMatcher(new CsrfSecurityRequestMatcher());
        http.headers().frameOptions().disable();

        http.formLogin()
            .loginPage("/login")
            .defaultSuccessUrl("/", true)
            .failureUrl(FORM_LOGIN_DEFAULT_FAILURE_URL)
            .usernameParameter(FORM_LOGIN_USERNAME_PARAM)
            .passwordParameter("password")
            .successHandler(new AuthenticationSuccessHandlerImpl())
            .failureHandler(new AuthenticationFailureHandlerImpl(
                    FORM_LOGIN_USERNAME_PARAM, FORM_LOGIN_DEFAULT_FAILURE_URL))
            .permitAll();

        configureSessionManagement(http);

        http.logout()
            .logoutUrl("/signout")
            .invalidateHttpSession(true)
            .logoutSuccessHandler(new LogoutSuccessHandlerImpl());

        http.addFilterAfter(new CsrfTokenGeneratorFilter(), CsrfFilter.class);

        http.authorizeRequests()
            .antMatchers("/license", "/termsofuse", "/privacypolicy", "/contactus", "/sessionexpired",
                    "/sessionout", "/signup", "/login/**", "/styles/**", "/images/**", "/bower_components/**",
                    "/uitk-core/**", "/app/**", "/css/**", "/uitk/**", "/webHelp/**")
            .permitAll()
            .anyRequest().authenticated();
    }
}
